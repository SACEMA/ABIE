---
title: "Estimating incidence from cross-sectional data"
date: 2016-05-12
output: rmarkdown::html_vignette
#output: rmarkdown::pdf_document
fig_caption: yes
vignette: >
  %\VignetteIndexEntry{Estimating Incidence}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Introduction

This vignette covers the use of the functions `incprops`, `inccounts`, and `prevcounts`. It is strongly recommended that the vignette "Introduction" be read before any use of this package.

The two primary functions for HIV incidence estimation are $incprops$ and $inccounts$. These take as arguments a summary of arbitrarily complex survey data sets capturing HIV prevalence and prevalence of recent HIV infection among HIV positive subjects. They return estimates of incidence, and, if specification of multiple cross-sectional surveys is provided, incidence differences (point estimates, confidence intervals, p values, and subsidiary output). The principal reference for the methodology underlying this implementation is Kassanjee et al. *Epidemiology*, 2012.[^1] Further guidance is provided in Kassanjee, McWalter, Welte. *AIDS Research and Human Retroviruses*, 2014.[^2], and some hitherto unpublished technical details are in the appendix of vignette "Introduction".

## Analytical Paradigm

A fundamental element in the conception of the *inctools* is that the primary entry point into the critical methodology which *inctools* implements is the function  $incprops$, which takes, as summary of the population state, estimates of HIV prevalence and the prevalence of *recent infection* amongst HIV positive subjects (including variance and covariance). These estimates, in turn, would usually be best derived by (potentially complex) preliminary analysis of the raw survey data documenting individual subjects' status ascertainment, cluster and strata membership, weighting, etc.

The derivation of these prevalence estimates from raw data is in principle facilitated by various algorithms which are implemented in other packages, and are essentially independent of any of the innovation captured in this package. Use of *inctools* does not imply any specific approach to the preliminary analytical methodology, but the widely used package *survey* (totally independently maintained, with no link to *inctools*) may be suitable for many typical data sets. Additionally, to facilitate 'naive', self contained within the package, analysis, the ancilliary function *prevcounts* is provided. This takes survey counts and produces prevalence estimates (for both HIV and recent infection, including variance) under the simplifying assumption of individual level random selection of subjects from a single population group.


## Using functions *incprops* and *inccounts*

The functions `incprops` and `inccounts` provide a near-identical interface, as further detailed in the help pages. Both functions take considerably pre-processed data specifying a recent infection test and a survey in which it is used:
* estimates of false recency rate (FRR--$\beta$) and mean duration of recent infection (MDRI--$\Omega_T$) and their respective relative standard errors and recency time cutoff (T)
*  and survey data: proportions (counts, if using function `inccounts`) of HIV positives (PrevH) and positives for recency (PrevR) and their relative standard errors.

A critical distinction is that with the use of *incprops*, variance of prevalences, including covariance, is explicitly supplied, and with the use of *inccounts*, variance emerges from counts and design effects, and there is no covariance.  

The output for a single survey is an estimate of incidence along with confidence intervals and RSE, estimated annual rate of infection and associated confidence intervals, and confidence intervals for parameters MDRI and FRR, which are deduced from input parameters.

The output for multiple surveys is the same output as for a single survey, along with pairwise comparisons of incidence rates, confidence intervals of differences, and tests of equality with p-values and RSE of differences.



```{r, fig.show='hold'}
prevcounts (N = c(5000,6000), N_H = c(1000,1100), N_testR = c(950,1060),
            N_R = c(100,70), DE_H = c(1.1,1.2), DE_R = c(1.2,1.3))
```



## Function `prevcounts`

Function `prevcounts`, while not strictly necessary (and indeed not recommended for final inference on incidence based on real survey data, presumably obtained at great cost and with considerable complex sampling structure) turns counts of:

* Number of subjects tested for HIV
* Number of subjects who tested positive for HIV
* Number of HIV positive subjects tested for recent infections
* Number of HIV positive subjects who tested positive for recent infections

into (point) estimates (and variance) of prevalence of HIV and prevalence of recent infection among HIV the positives. At heart, this is a relatively simple multinomial distribution analysis (trinomial, in the case of complete coverage of recency testing amongst HIV positives) and could be accomplished without any significant innovation directly arising out of the core methods of this package, but function *prevcounts* at least provides a consistent entry point into this analysis, using arguments consistently named to align to the other functions, including appropriate design effects. The most likely use of *prevcounts* is probably indirectly through *inccounts*, but it is provided in user-exposed form for its intuitive supportive value and for recycling into user customisations beyond routine primary incidence estimation.

**The use of *prevcounts* implies an interpretation of these counts which precludes non-null covariance of the prevalence of HIV and the prevalence of recency.**



For a single survey:

```{r, fig.show='hold'}
library("inctools")
```



```{r, fig.show='hold'}
prevcounts(N = 5000, N_H = 1000, N_testR = 1000, N_R = 70, DE_H = 1.1 DE_R = 1.5)
```
Note that:

* It is spelled out that in this instance all HIV positive subjects were tested for recent infection

* A design effect is provided for adjusting the variance of the prevalence of HIV

* An independent design effect is provided for adjusting the variance of the prevalence of recent infection amongst HIV positives

* There is no mention of a total sample size in excess of the number of individuals in the underlying survey, on whom there is no HIV status information. A more sophisticated analysis might well use this larger sample size, and additionally account for the frequency, and risk-factor distribution, of missingness, but the conception *prevcounts* does not require this data. The use of design effects, though limited and ultimately problematic, is the appropriate way to insert distributional information beyond the implied two independent binomial distributions for each prevalence.


Input can be provided for two or more surveys in vector form, using the concatenation expression `c()`:

```{r, fig.show='hold'}
prevcounts (N = c(5000,6000), N_H = c(1000,1100), N_testR = c(950,1060),
            N_R = c(100,70), DE_H = c(1.1,1.2), DE_R = c(1.2,1.3))
```

Note the construction that both surveys are declared to have the same design effect on the variance of HIV prevalence, which can be captured in a non-vectorised specification of $DE_H$.



[^1]: Kassanjee, R., McWalter, T.A., Baernighausen, T. and Welte, A. "A new general biomarker-based incidence estimator." Epidemiology; 2012, 23(5): 721-728; doi:[10.1097/EDE.0b013e3182576c07](http://dx.doi.org/10.1097/EDE.0b013e3182576c07); [PubMed](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3500970/).

[^2]: Kassanjee, R., McWalter, T.A. and Welte, A. "Short Communication:
Defining Optimality of a Test for Recent Infection for HIV Incidence Surveillance." AIDS Research and Human Retroviruses; 2014, 30(1): 45-49; doi:[10.1089/aid.2013.0113](http://dx.doi.org/10.1089/aid.2013.0113); [PubMed](http://www.ncbi.nlm.nih.gov/pubmed/24090052).





## fragments

while taking into account of design effects, which factor into the relative standard error of prevalence of HIV positivity and recenecy. `inccounts` has an option for design effects. The function `prevcounts` takes count data from a prevalence survey and produces estimates of prevalences and relative standard errors. Design effects are assumed


Note that the use of *prevcounts* implies an interpretation of these counts which precludes non-null covariance of the prevalence of HIV and recency.

as well a test rejection threshold $\alpha$ (default=0.05)

allows for the use function `incprops`
negligible unless the user specifies otherwise. Note that the input values for design effects are assumed to be known by the user.
