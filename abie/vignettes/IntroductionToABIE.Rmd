---
title: "Introduction to the ABIE package"
author: "Alex Welte"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
  %\VignetteIndexEntry{Integrating TCGA Data}
---

## I have not even begun to write this vignette - it's a staring point for Alex

##Introduction to ABIE

SACEMA (http://www.sacema.org) is releasing a major update to its Assay-Based Incidence Estimation (ABIE) toolbox.

The central concern in ABIE is the estimation of (presumably HIV) incidence through cross-sectional biomarker measurement – in particular, biomarkers supporting classification of cases (infections) as recently or non-recently acquired.  Although almost all attention paid to this topic is in the context of HIV epidemiology, the underlying concepts are in fact general, and they may, in time, find meaningful application to other chronic conditions. 

This set of spreadsheets (“calculators”) is freely available in open source, editable form, and as such comes without warranty, although great care has been taken to ensure correctness and stability.  Sheets are superficially locked to help prevent unintended edits, but can be unlocked without a password. They are distributed in Microsoft Excel (.xlsx) format.  As they rely only on simple formulas (i.e. no embedded visual basic or complex macros) they can be easily ported to other platforms. 

Potential users include:
* researchers planning, implementing, or analysing data from, major surveys
* officers in departments of health or statistical bureaux
* reviewers of protocols or articles
* product developers
* funders 
* teachers/trainers and students

The lack of any formal warranty notwithstanding, users are invited to contact SACEMA for assistance and are indeed requested to provide any notification of possible errors, or feedback about functionality. 

## Overview of ABIE (R package) version 1 

June 2015 marks the release of version 3 of the ABIE toolbox. 

In version 3, there are separate calculators (spreadsheet “workbooks”):
* Incidence_Prevalence_Calculator – produces a prevalence and incidence estimate from  a single cross-sectional survey
* Incidence_Difference_Calculator  – systematically compares incidence estimates from two cross-sectional surveys
* Sample_Size_Calculator – calculates a minimal sample size to provide desired precision of incidence estimate (in a hypothetical context) or “power” to detect a difference in incidence between two hypothetical contexts
* Power_Calculator – calculates “power” to detect a hypothetical incidence difference/trend 
* Test_Performance_Calculator – summarises “performance” of a recent infection test (into a standard error of the incidence estimate), given estimated test properties and the prevalence/incidence in a hypothetical context 

While each spreadsheet calculator tackles a narrow class of calculations, some spreadsheets enumerate various logically distinct cases, and offer multiple layers (“worksheets”) to provide relevant options, support sensitivity analysis, etc.  Each ABIE worksheet level tool is organised around the following principles:
* All cells which are not designated for data entry are locked by default. They can be unlocked without a password using the “unprotect sheet” functionality on the “review” tab.
* Cells, and text, are colour coded to indicate whether they represent input, intermediate results, primary output, or ancillary results. A colour key is provided in each relevant worksheet. 

Each calculator is accompanied by a non-technical “user guide”.  The user guides for each calculator are included in a dedicated worksheet. 

Little to no technical knowledge of the underlying statistical theory is required to use the calculators, but users need to be familiar with basic ideas around HIV epidemiology and the use of assays to establish recent vs non-recent HIV infection.  A technical document detailing the new formulas derived for the development of ABIE v3 is in preparation.

To support correct use of the tool, there are numerous warnings and error messages designed to appear in response to a variety of triggers. These messages are usually located in a column a little to the right of a cell which triggered them.  Within a given workbook, all of these messages are in a single column, though the column used varies between workbooks.  The messages column is indicated near the top of each workbook, and it is worth checking that this column is visible while inputs are being provided.


* Warnings highlight possible problems such as input parameters that are unlikely to be consistent with robust use of the tool. 
* Errors indicate a fundamental breakdown in consistency, such as a greater number of recent HIV infections than HIV infections. In the case of an error, expected output is suppressed.



## Random stuff

## Install the package from source

Install devtools

<!-- ```{r}
install.packages("devtools", repos = "http://cran.rstudio.com")
```  -->

Install dependencies manually (shouldn't be necessary ordinarily)

<!-- ```{r}
install.packages(c("plyr","glm2","cubature","MASS","ggplot2","pracma"), repos = "http://cran.rstudio.com")
``` -->

If you are not on Windows and wish to perform bootstrapping in parallel, you also need the following packages

<!-- ```{r}
install.packages(c("foreach","doMC"), repos = "http://cran.rstudio.com")
``` -->

Now Install package using devtools

Note: Change the working directory in the following line to the local location of "abie". Note: dependencies have already been manually installed.

<!-- ```{r} -->
<!-- setwd("~../") -->
<!-- devtools::install(dependencies=FALSE) -->
<!-- ``` -->


Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format:

- Never uses retina figures
- Has a smaller default figure size
- Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style

## Vignette Info

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
