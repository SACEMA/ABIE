---
title: "Estimating incidence from cross-sectional data"
date: Sys.Date()
output: rmarkdown::html_vignette
#output: rmarkdown::pdf_document
fig_caption: yes
vignette: >
  %\VignetteIndexEntry{Inference}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

This vignette covers the use of the functions `incprops`, `inccounts`, and `prevcounts`.

The *inctools* package provides two functions for HIV incidence estimation: $incprops$ and $inccounts$, and ancillary function $prevcounts$. These functions take as arguments the specifica of recent HIV infection, and they return estimates of incidence, and incidence differences (in the case of multiple cross-sectional surveys).
and confidence intervals, among other output. See the function help pages for specific examples of running the code. The principal reference for the methods behind this implementation is given by Kassanjee et al. *Epidemiology*, 2012.[^1] Further guidance is provided in Kassanjee, McWalter, Welte. *AIDS Research and Human Retroviruses*, 2014.[^2]

This vignette will describe the use of necessary functions and some background on methods specific to this package.

## `prevcounts`

Function `prevcounts`, while not strictly necessary for inference on incidence, allows for using function `incprops` while taking into account of design effects, which factor into the relative standard error of prevalence of HIV positivity and recenecy. `inccounts` has an option for design effects. The function `prevcounts` takes count data from a prevalence survey and produces estimates of prevalences and relative standard errors. Design effects are assumed negligible unless the user specifies otherwise. Note that the input values for design effects are assumed to be known by the user.


For a single survey:

```{r, fig.show='hold'}
library("inctools")
```



```{r, fig.show='hold'}
prevcounts(N = 5000, N_H = 1000, N_testR = 1000, N_R = 70, DE_R = 1.1)
```
the output for the function is estimated prevalence of HIV given survey counts (5000/1000), estimated proportion of those tested who are defined as recently infected by the assay, and the relative standard error (RSE)--the ratio of standard deviation of the estimator to the estimate, which is itself an estimate of $\sigma/\mu$.   

The number of individuals tested for recency of infection is 1000 (in this example equal to the total number of individuals who tested positive for HIV).

The number of recent infections was calculated by the assay to be 70.

Design effects in the above example are assumed negligible for test of positivity, but are given as 1.1 for the test of recency.

For two or more surveys, the function input is given in vector form using the concatenation expression `c()`.

```{r, fig.show='hold'}
prevcounts (N = c(5000,5000), N_H = c(1000,1000), N_testR = c(1000,1000),
            N_R = c(100,70), DE_H = 1, DE_R = c(1,1.1))
```
Note the construction that survey 1 (the first survey entered) had design effects assumed negligible (=1), while the second survey had an estimated design effect (=1.1). These inputs must be followed sequentially for surveys in multiple entries.

## `incprops` and `inccounts`

The functions `incprops` and `inccounts` uses an identical syntax scheme to that shown above for `prevcounts`, and given in the functions' help pages. Both functions take data that has already been calculated about the assay used for testing recency--estimates of false recency rate (FRR--$\beta$) and mean duration of recent infection (MDRI--$\Omega_T$) and their respective relative standard errors and the time cut threshold for recency in days (T)--as well a test rejection threshold $\alpha$ (default=0.05) and survey data: proportions (counts, if using function `inccounts`) of HIV positives (PrevH) and positives for recency (PrevR) and their relative standard errors.

The output for a single survey is an estimate of incidence along with confidence intervals and RSE, estimated annual rate of infection and associated confidence intervals, and confidence intervals for parameters MDRI and FRR, which are deduced from use input.

The output for multiple surveys is the same output as for a single survey, along with pairwise comparisons of incidence rates, confidence intervals of differences, and tests of equality with p-values and RSE of differences. Run the code given in the examples section at the bottom of the function help page `help("incprops")` for examples of this implementation and output.

The delta method calculation of the estimator variance is described in the second reference, however the delta method approximation of the variance of the difference of incidence estimators has not been described until now. There are three cases that can arise: (1) the same test is used for both assays; (2) the tests are different with independent FRR; (3) the tests are independent with different FRR and different MDRI. The option for assay scheme is specified in both `incprops` and `inccounts` by function parameter `BMest`. Subscripts 1 and 2 in the parameter notation denote associated survey or test parameters. The variances of the three cases follow.



[^1]: Kassanjee, R., McWalter, T.A., Baernighausen, T. and Welte, A. "A new general biomarker-based incidence estimator." Epidemiology; 2012, 23(5): 721-728; doi:[10.1097/EDE.0b013e3182576c07](http://dx.doi.org/10.1097/EDE.0b013e3182576c07); [PubMed](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3500970/).

[^2]: Kassanjee, R., McWalter, T.A. and Welte, A. "Short Communication:
Defining Optimality of a Test for Recent Infection for HIV Incidence Surveillance." AIDS Research and Human Retroviruses; 2014, 30(1): 45-49; doi:[10.1089/aid.2013.0113](http://dx.doi.org/10.1089/aid.2013.0113); [PubMed](http://www.ncbi.nlm.nih.gov/pubmed/24090052).
